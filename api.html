<!DOCTYPE html>
<html>
<head>
    <title>API + 模型加载测试</title>
    <!-- 加载TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
</head>
<body>
    <h1>API + 模型测试</h1>
    
    <!-- API测试区域 -->
    <div>
        <h2>API测试</h2>
        <button id="apiBtn">调用API</button>
        <div id="apiResult">等待API调用...</div>
    </div>
    
    <!-- 模型测试区域 -->
    <div>
        <h2>模型测试</h2>
        <button id="modelBtn">加载模型</button>
        <div id="modelStatus">准备加载模型...</div>
        <div id="predictionResult"></div>
    </div>

    <script>
        // API调用功能
        document.getElementById('apiBtn').addEventListener('click', async function() {
            const resultDiv = document.getElementById('apiResult');
            resultDiv.innerText = '正在调用API...';
            
            try {
                // 替换为您的实际API端点
                const response = await fetch('https://api.example.com/data');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('API响应数据:', data);
                resultDiv.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            } catch (error) {
                console.error('API调用失败:', error);
                resultDiv.innerText = `API调用失败: ${error.message}`;
            }
        });

        // 模型加载功能
        let model = null;
        
        document.getElementById('modelBtn').addEventListener('click', async function() {
            const statusDiv = document.getElementById('modelStatus');
            const predictionDiv = document.getElementById('predictionResult');
            
            if (model) {
                statusDiv.innerText = '模型已加载，进行预测...';
                try {
                    // 示例预测 - 替换为您的实际预测逻辑
                    const input = tf.tensor2d([[5]]); // 示例输入
                    const prediction = model.predict(input);
                    const predictionValue = await prediction.data();
                    
                    predictionDiv.innerHTML = `
                        <h3>预测结果:</h3>
                        <p>输入: 5</p>
                        <p>预测值: ${predictionValue[0].toFixed(4)}</p>
                    `;
                    
                    // 清理张量
                    input.dispose();
                    prediction.dispose();
                } catch (error) {
                    console.error('预测失败:', error);
                    predictionDiv.innerText = `预测失败: ${error.message}`;
                }
                return;
            }
            
            statusDiv.innerText = '正在加载模型...';
            
            try {
                // 正确路径：模型文件在根目录
                model = await tf.loadLayersModel('./model.json');
                
                console.log("模型加载成功！");
                console.log("模型输入形状:", model.inputs[0].shape);
                console.log("模型输出形状:", model.outputs[0].shape);
                
                statusDiv.innerText = '模型加载成功！点击按钮进行预测';
                
                // 显示模型摘要
                predictionDiv.innerHTML = `
                    <h3>模型信息:</h3>
                    <p>输入形状: ${model.inputs[0].shape}</p>
                    <p>输出形状: ${model.outputs[0].shape}</p>
                    <p>层数: ${model.layers.length}</p>
                `;
            } catch (error) {
                console.error('模型加载失败:', error);
                statusDiv.innerText = `模型加载失败: ${error.message}`;
                
                // 详细错误信息
                predictionDiv.innerHTML = `
                    <h3>错误详情:</h3>
                    <p>${error.message}</p>
                    <p>请检查:</p>
                    <ul>
                        <li>model.json文件是否在根目录</li>
                        <li>权重文件(.bin)是否在根目录</li>
                        <li>文件名大小写是否正确</li>
                        <li>文件是否超过100MB限制</li>
                    </ul>
                `;
            }
        });
    </script>
</body>
</html>
